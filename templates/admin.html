<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Attendance</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        .admin-page .admin-container {
            width: 95vw !important;       /* fill most of the viewport */
            max-width: 1200px !important; /* cap on large screens */
            margin: 0 auto !important;
            padding: 20px !important;
            box-sizing: border-box;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .section-divider {
            margin: 40px 0 20px;
            border-top: 2px solid #ddd;
        }
        form label { font-weight: bold; }
    </style>
</head>
<body class="admin-page">
    <div class="container admin-container">
        <h1>Admin Panel</h1>

        <!-- Attendance Table -->
        <h3>Today's Attendance</h3>
        <p><strong>Date:</strong> {{ today }}</p>

        {% if records %}
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Employee ID</th>
                        <th>Full Name</th>
                        <th>Check-In Time</th>
                        <th>Check-Out Time</th>
                        <th>Late Status</th>
                        <th>Hours Worked</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                        <tr>
                            <td>{{ record.employee_id }}</td>
                            <td>{{ record.first_name }} {{ record.last_name }}</td>
                            <td>{{ record.check_in_time.strftime('%H:%M:%S') if record.check_in_time else 'Not Recorded' }}</td>
                            <td>{{ record.check_out_time.strftime('%H:%M:%S') if record.check_out_time else 'Not Recorded' }}</td>
                            <td>{{ record.late_status }}</td>
                            <td>{{ record.hours_worked if record.hours_worked else 'Not Available' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No attendance records found for today.</p>
        {% endif %}

        <!-- Divider -->
        <div class="section-divider"></div>

        <!-- Monthly Attendance Summary -->
        <h3>Monthly Attendance Summary</h3>

        <form method="GET" action="/admin" style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
        <!-- Keep existing team member filter in URL if present -->
        {% if selected_member %}
            <input type="hidden" name="member" value="{{ selected_member }}">
        {% endif %}

        <label for="month">Select Month:</label>
        <input type="month" id="month" name="month" value="{{ selected_month }}" onchange="this.form.submit()" style="padding:8px;">
        <noscript><button type="submit">Apply</button></noscript>
        </form>

        {% if monthly_summary and monthly_summary|length > 0 %}
        <table class="attendance-table">
        <thead>
            <tr>
            <th>Name</th>
            <th>Present Days</th>
            <th>Absent Days</th>
            <th>Leaves Applied</th>
            <th>Average Working Hrs</th>
            </tr>
        </thead>
        <tbody>
            {% for row in monthly_summary %}
            <tr>
            <td>{{ row.name }}</td>
            <td>{{ row.present_days }}</td>
            <td>{{ row.absent_days }}</td>
            <td>{{ row.leave_days if row.leave_days else 0 }}</td>
            <td>{{ row.avg_hours }}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
        {% else %}
        <p>No attendance data found for the selected month.</p>
        {% endif %}
        <!-- Divider -->
        <div class="section-divider"></div>

        <!-- Leave Summary (Financial Year) -->
        <h3>Leave Summary (Financial Year)</h3>

        <form method="GET" action="/admin" style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
            <!-- keep other filters sticky -->
            {% if selected_member %}
                <input type="hidden" name="member" value="{{ selected_member }}">
            {% endif %}
            {% if selected_month %}
                <input type="hidden" name="month" value="{{ selected_month }}">
            {% endif %}

            <label for="fy">Select FY:</label>
            <select id="fy" name="fy" onchange="this.form.submit()" style="padding:8px;">
                {% for fy in fy_options %}
                    <option value="{{ fy }}" {% if fy == selected_fy %}selected{% endif %}>{{ fy }}</option>
                {% endfor %}
            </select>
            <noscript><button type="submit">Apply</button></noscript>
        </form>

        {% if leave_summary and leave_summary|length > 0 %}
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Sick Leaves (6)</th>
                        <th>Casual Leaves (8)</th>
                        <th>Privilege Leaves (12)</th>
                        <th>Total Leaves (26)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in leave_summary %}
                        <tr>
                            <td>{{ row.name }}</td>
                            <td>{{ row.sick }}</td>
                            <td>{{ row.casual }}</td>
                            <td>{{ row.privilege }}</td>
                            <td>{{ row.total }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No approved leave data found for {{ selected_fy }}.</p>
        {% endif %}

        <!-- Divider -->
        <div class="section-divider"></div>

        <!-- Team Work Tracker Section -->
        <h3>Team Work Tracker</h3>

        <!-- Filter by Team Member -->
        <form method="GET" action="/admin" style="margin-bottom: 20px;">
            <!-- keep month and FY sticky while changing member -->
            {% if selected_month %}
                <input type="hidden" name="month" value="{{ selected_month }}">
            {% endif %}
            {% if selected_fy %}
                <input type="hidden" name="fy" value="{{ selected_fy }}">
            {% endif %}

            <label for="member">Filter by Team Member:</label>
            <select name="member" id="member" onchange="this.form.submit()" style="width: 250px; padding: 8px;">
                <option value="">-- All Members --</option>
                {% for member in all_members %}
                    <option value="{{ member }}" {% if member == selected_member %}selected{% endif %}>{{ member }}</option>
                {% endfor %}
            </select>
        </form>

        {% if team_tasks %}
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Client Name</th>
                        <th>Video Type</th>
                        <th>Video Name</th>
                        <th>Video Editor</th>
                        <th>Start Date</th>
                        <th>Delivery Date</th>
                        <th>Quality Score</th>
                        <th>Delivery Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in team_tasks %}
                        <tr>
                            <td>{{ task["Client Name"] }}</td>
                            <td>{{ task["Video Type"] }}</td>
                            <td>{{ task["Video Name"] }}</td>
                            <td>{{ task["Video Editor"] }}</td>
                            <td>{{ task["Start Date"] }}</td>
                            <td>{{ task["Delivery Date"] }}</td>
                            <td>{{ task["Quality Score"] }}</td>
                            <td>
                                {% if task["Delivery Status"] == "Client Review" %}
                                    <span style="color: #D4AC0D;">{{ task["Delivery Status"] }}</span>
                                {% elif task["Delivery Status"] == "Pending" %}
                                    <span style="color: #E74C3C;">{{ task["Delivery Status"] }}</span>
                                {% elif task["Delivery Status"] == "In Progress" %}
                                    <span style="color: #E67E22;">{{ task["Delivery Status"] }}</span>
                                {% elif task["Delivery Status"] == "Done" %}
                                    <span style="color: #05a93cff;">{{ task["Delivery Status"] }}</span>
                                {% else %}
                                    {{ task["Delivery Status"] }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No tasks found for the selected team member.</p>
        {% endif %}

        <!-- Divider -->
        <div class="section-divider"></div>

        <p style="margin-top: 40px;"><a href="/" class="back-link">Back to Home</a></p>
    </div>
</body>
</html>