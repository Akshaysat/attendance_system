<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check-Out</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div id="page-loader" class="hidden" aria-live="polite" aria-busy="true">
    <div class="loader-box">
        <div class="spinner" role="img" aria-label="Loading"></div>
        <div>Loadingâ€¦</div>
    </div>
    </div>
    <div class="container">
        <h1>Check-Out</h1>
        <p>Welcome, {{ session['username'] }}!</p>
        <form method="POST" action="/checkout">
            <button type="submit">Check-Out</button>
        </form>
        <p><a href="/">Back to Home</a></p>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    <script>
    (function(){
    const loader = document.getElementById('page-loader');
    function show(){ if(loader) loader.classList.remove('hidden'); }
    function hide(){ if(loader) loader.classList.add('hidden'); }

    // Show on any form submission (covers check-in/out, filters, login, etc.)
    function hookForms(){
        document.querySelectorAll('form').forEach(f => {
        f.addEventListener('submit', () => { show(); });
        });
    }

    // Show on navigational link clicks
    function hookLinks(){
        document.querySelectorAll('a[href]').forEach(a => {
        a.addEventListener('click', () => {
            const href = a.getAttribute('href');
            if (!href || href.startsWith('#') || href.startsWith('javascript:')) return;
            if (a.target === '_blank' || a.hasAttribute('data-no-loader')) return;
            show();
        });
        });
    }

    // Ensure loader hides when page restored from bfcache (back/forward)
    window.addEventListener('pageshow', hide);

    document.addEventListener('DOMContentLoaded', () => {
        hookForms();
        hookLinks();
    });
    })();
    </script>
</body>
</html>